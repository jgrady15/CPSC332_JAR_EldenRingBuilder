USE cs332s26;

DROP TABLE IF EXISTS POLICYHOLDER, INS_COMPANY_NAME, POLICIES, BALANCES, DRIVING_ACTIVITY, ADDITIONAL_DRIVERS;

CREATE TABLE POLICYHOLDER(
	CustomerID CHAR(7) UNIQUE NOT NULL,
	Name VARCHAR(50),
  Date_of_Birth DATE,
  Phone_Number INT NOT NULL,
  Address VARCHAR(80),
  Year_Of_Experience INT,
  PRIMARY KEY(CustomerID)
);

CREATE TABLE INS_COMPANY_NAME(
	CustSvc_PH INT NOT NULL,
	CEO_Name VARCHAR(50) NOT NULL,
	Hdquarter_address VARCHAR(80),
	Email_address VARCHAR(30),
	PRIMARY KEY(CustSvc_PH)
);

CREATE TABLE POLICIES(
	Policy_Number INT UNIQUE NOT NULL,
  CustomerID CHAR(7) NOT NULL,
  Policy_Type CHAR(4) NOT NULL,
	CustSvc_PH INT NOT NULL,
  Start_date DATE,
  End_date DATE,
  Total_Premium INT,
  PRIMARY KEY(Policy_Number),
  FOREIGN KEY (CustomerID) REFERENCES POLICYHOLDER(CustomerID),
	FOREIGN KEY (CustSvc_PH) REFERENCES INS_COMPANY_NAME(CustSvc_PH)
);

CREATE TABLE BALANCES(
	Policy_Number INT NOT NULL,
  Total_Premium INT,
  Last_Payment_Date DATE,
  Current_Balance_Remaining INT,
  PRIMARY KEY (Policy_Number),
  FOREIGN KEY (Policy_Number) REFERENCES POLICIES(Policy_Number)
);

CREATE TABLE DRIVING_ACTIVITY(
	CustomerID CHAR(7) NOT NULL,
  Violation_Type VARCHAR(30),
  Number_of_Points INT,
  Violation_Date DATE,
  Viol_ID INT NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (Viol_ID),
  FOREIGN KEY (CustomerID) REFERENCES POLICYHOLDER(CustomerID)
);

CREATE TABLE ADDITIONAL_DRIVERS(
	CustomerID CHAR(7) NOT NULL,
  Name VARCHAR(30),
  Date_of_Birth DATE,
  PRIMARY KEY (CustomerID),
  FOREIGN KEY (CustomerID) REFERENCES POLICYHOLDER(CustomerID)
);

#populate ins co
INSERT INTO INS_COMPANY_NAME VALUES (1112223333, "Meilon Tusk", "1313 Anywhere Land, Westwood, TN, 95014", "Dontbother@memecoInsCo.com");

#populate policyholders
INSERT INTO POLICYHOLDER VALUES ("P137024", "Olivia Rodriguez", '2003-02-20', 1115671234, "55 Main St, Palo Alto, CA 94305", 3);
INSERT INTO POLICYHOLDER VALUES ("P458357", "Jennifer Schwarz", '2001-03-01', 1112344321, "555 N Commonwealth, Fullerton, CA 92831", 4);
INSERT INTO POLICYHOLDER VALUES ("P875147", "Johnny Shallow", '2000-09-19', 1117774444, "2901 Yorba Linda, Fullerton, CA 92831", 5);
INSERT INTO POLICYHOLDER VALUES ("P145414", "Zendaya Holland", '1999-01-11', 1117418529, "33 Bastanchury, Brea, CA 92805", 2);
INSERT INTO POLICYHOLDER VALUES ("P370124", "Jennifer Affleck", '1998-05-10', 1113692581, "871 Tram Rd, Sham City, CA 94574", 1);
INSERT INTO POLICYHOLDER VALUES ("P002005", "Mila Kutcher", '2002-01-11', 1117531281, "847 Stanley Park, Vancouver, WA, 97521", 1);
INSERT INTO POLICYHOLDER VALUES ("P333444", "Timothy Katz", '1997-02-05', 1119517412, "87 Tinley Park, Chicago, IL, 35712", 6);
INSERT INTO POLICYHOLDER VALUES ("P987654", "Iman Bhatti", '2001-01-12', 1113868524, "676 Hipster St, Portland, OR 98504", 6);
INSERT INTO POLICYHOLDER VALUES ("P654321", "Sang SaeChao", '2003-03-11', 1112223333, "100 Pike Place, Seattle, WA 96002", 2);
INSERT INTO POLICYHOLDER VALUES ("P000001", "Miguel DeLaConcha", '2001-05-11', 1118884567, "9283 Breezy View, Salt Lake City, UT 78001", 4);

#populate POLICIES
INSERT INTO POLICIES VALUES (450120, "P137024", "AUTO", 1112223333, '2021-06-01', '2021-12-01', 1801);
INSERT INTO POLICIES VALUES (450129, "P458357", "AUTO", 1112223333, '2022-02-15', '2022-08-15', 657);
INSERT INTO POLICIES VALUES (450131, "P458357", "CYCL", 1112223333, '2021-01-01', '2021-07-01', 2300);
INSERT INTO POLICIES VALUES (450137, "P875147", "AUTO", 1112223333, '2022-04-02', '2022-10-02', 951);
INSERT INTO POLICIES VALUES (450139, "P875147", "RV", 1112223333, '2022-03-19', '2022-09-19', 157);
INSERT INTO POLICIES VALUES (450141, "P145414", "AUTO", 1112223333, '2022-01-23', '2022-07-23', 761);
INSERT INTO POLICIES VALUES (450142, "P145414", "CYCL", 1112223333, '2022-02-12', '2022-08-12', 323);
INSERT INTO POLICIES VALUES (450149, "P145414", "RV", 1112223333, '2022-01-08', '2022-07-08', 400);
INSERT INTO POLICIES VALUES (450323, "P370124", "AUTO", 1112223333, '2022-01-21', '2022-07-21', 790);
INSERT INTO POLICIES VALUES (450324, "P370124", "CYCL", 1112223333, '2022-02-01', '2022-08-01', 1190);
INSERT INTO POLICIES VALUES (450325, "P370124", "RV", 1112223333, '2022-03-15', '2022-09-15', 122);
INSERT INTO POLICIES VALUES (450327, "P370124", "HOME", 1112223333, '2022-02-16', '2022-08-16', 917);
INSERT INTO POLICIES VALUES (450390, "P002005", "AUTO", 1112223333, '2022-01-22', '2022-07-22', 813);
INSERT INTO POLICIES VALUES (450392, "P002005", "HOME", 1112223333, '2022-01-22', '2022-07-22', 1587);
INSERT INTO POLICIES VALUES (450401, "P333444", "AUTO", 1112223333, '2022-03-17', '2022-09-17', 201);
INSERT INTO POLICIES VALUES (450402, "P333444", "HOME", 1112223333, '2022-03-17', '2022-09-17', 1283);
INSERT INTO POLICIES VALUES (450403, "P333444", "CYCL", 1112223333, '2022-03-17', '2022-09-17', 1438);
INSERT INTO POLICIES VALUES (450405, "P987654", "CYCL", 1112223333, '2022-02-12', '2022-08-12', 817);
INSERT INTO POLICIES VALUES (450478, "P654321", "RV", 1112223333, '2022-02-27', '2022-08-27', 314);
INSERT INTO POLICIES VALUES (450490, "P000001", "HOME", 1112223333, '2022-01-15', '2022-07-15', 765);

#populate BALANCES
INSERT INTO BALANCES VALUES (450120, 1801, '2022-04-01', 0);
INSERT INTO BALANCES VALUES (450129, 657, '2022-04-15', 323);
INSERT INTO BALANCES VALUES (450131, 2300, '2022-04-01', 1100);
INSERT INTO BALANCES VALUES (450137, 951, '2022-04-02', 289);
INSERT INTO BALANCES VALUES (450139, 157, '2022-04-01', 76);
INSERT INTO BALANCES VALUES (450141, 761, '2022-04-01', 231);
INSERT INTO BALANCES VALUES (450142, 323, '2022-04-19', 100);
INSERT INTO BALANCES VALUES (450149, 400, '2022-04-08', 243);
INSERT INTO BALANCES VALUES (450323, 790, '2022-04-21', 502);
INSERT INTO BALANCES VALUES (450324, 1190, '2022-04-01', 413);
INSERT INTO BALANCES VALUES (450325, 122, '2022-04-15', 34);
INSERT INTO BALANCES VALUES (450327, 917, '2022-04-16', 314);
INSERT INTO BALANCES VALUES (450390, 813, '2022-04-22', 247);
INSERT INTO BALANCES VALUES (450392, 1587, '2022-04-22', 640);
INSERT INTO BALANCES VALUES (450401, 201, '2022-04-17', 65);
INSERT INTO BALANCES VALUES (450402, 1283, '2022-04-17', 322);
INSERT INTO BALANCES VALUES (450403, 1438, '2022-04-17', 475);
INSERT INTO BALANCES VALUES (450405, 817, '2022-04-12', 201);
INSERT INTO BALANCES VALUES (450478, 314, '2022-04-27', 143);
INSERT INTO BALANCES VALUES (450490, 765, '2022-04-15', 401);

#populate DRIVING_ACTIVITY
INSERT INTO DRIVING_ACTIVITY VALUES ("P137024", "SPEEDING", 1, '2020-12-01',001);
INSERT INTO DRIVING_ACTIVITY VALUES ("P137024", "STOP", 1, '2021-06-05',002);
INSERT INTO DRIVING_ACTIVITY VALUES ("P458357", "Ran a stop", 2, '2022-01-02',003);
INSERT INTO DRIVING_ACTIVITY VALUES ("P875147","RED LIGHT", 2, '2021-03-19',004);
INSERT INTO DRIVING_ACTIVITY VALUES ("P875147", "Rear-end", 1, '2022-02-01',005);
INSERT INTO DRIVING_ACTIVITY VALUES ("P145414", "STREET RACING", 4, '2021-11-01',006);
INSERT INTO DRIVING_ACTIVITY VALUES ("P002005", "DUI", 6, '2020-01-01',007);
INSERT INTO DRIVING_ACTIVITY VALUES ("P987654", "DUI", 6, '2021-07-04',008);
INSERT INTO DRIVING_ACTIVITY VALUES ("P987654", "RECKLESS", 4, '2021-10-31',009 );
INSERT INTO DRIVING_ACTIVITY VALUES ("P987654", "FELONY ELUDE", 8,'2021-10-31',010);
INSERT INTO DRIVING_ACTIVITY VALUES ("P987654", "SPEEDING", 1, '2022-04-15',011);
INSERT INTO DRIVING_ACTIVITY VALUES ("P000001","Not at-fault", 0, '2022-01-01',012);


#populate ADDITIONAL_DRIVERS
INSERT INTO ADDITIONAL_DRIVERS VALUES ("P875147", "Kylie Banner", '2006-01-01' );
INSERT INTO ADDITIONAL_DRIVERS VALUES ("P145414", "Justin Smith", '2005-07-08');
INSERT INTO ADDITIONAL_DRIVERS VALUES ("P370124", "Timothy Spanner", '2004-11-01');
INSERT INTO ADDITIONAL_DRIVERS VALUES ("P654321", "Jennifer Tam",'2005-08-19');
INSERT INTO ADDITIONAL_DRIVERS VALUES ("P000001", "Tanner Bout", '2002-03-11');

# VIEWS

# Bill Summary for Customer
CREATE VIEW BALANCE_VIEW AS
SELECT POLICIES.CustomerID, Name, Policy_Type, Current_Balance_Remaining
FROM BALANCES, POLICIES, POLICYHOLDER
WHERE BALANCES.Policy_Number = POLICIES.Policy_Number and POLICIES.CustomerID = POLICYHOLDER.CustomerID;

SELECT * FROM BALANCE_VIEW;


# Customer driving record
CREATE VIEW DRIVING_RECORDS AS
SELECT Name, Violation_Type, Number_of_Points
FROM DRIVING_ACTIVITY, POLICYHOLDER
WHERE DRIVING_ACTIVITY.CustomerID = POLICYHOLDER.CustomerID;

SELECT * FROM DRIVING_RECORDS;
